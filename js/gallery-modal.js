//hrôzostrašne vyzerajúca definícia slovníku z obrázkami
//nebudem klamať, na tvorbu tohto slovníka som si spravil python script
let images = {
    "27": {
        "src": "img/Rebecca.gif",
        "alt": "",
        "hover": "Bang!",
        "thumb": {
            "src": "img/Rebecca.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "26": {
        "src": "img/Synth_City_2.png",
        "alt": "Synthwave city street with two texts spelling retro night and 80's hits",
        "hover": "Time to hit those sweet sweet retro tunes",
        "thumb": {
            "src": "img/Synth_City_2.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "25": {
        "src": "img/Synth_City_1.png",
        "alt": "Synthwave city street",
        "hover": "Lost in the glow",
        "thumb": {
            "src": "img/Synth_City_1.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "24": {
        "src": "img/AE86.png",
        "alt": "Toyota corolla AE86 in yellow with black trim",
        "hover": "Kansei Doritos!",
        "thumb": {
            "src": "img/AE86.png",
            "mode": "contain",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "23": {
        "src": "img/Desktop_2.png",
        "alt": "Image of old pc desktop where a video call is happening",
        "hover": "Now in color!",
        "thumb": {
            "src": "img/Desktop_2.png",
            "mode": "none",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "22": {
        "src": "img/Desktop_1.png",
        "alt": "Image of old pc desktop where a video call is happening",
        "hover": "Can you tell I was obsessed with needy streamer overload?",
        "thumb": {
            "src": "img/Desktop_1.png",
            "mode": "none",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "21": {
        "src": "img/Virus_PC.png",
        "alt": "Pixel-art of Pc desktop with virus installed",
        "hover": "Let's not dwell on the absurdity of video chats in that era",
        "thumb": {
            "src": "img/Virus_PC.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "20": {
        "src": "img/Girl_0.png",
        "alt": "Pixel-art of a young girl",
        "hover": "Looks cute, doesn't it?",
        "thumb": {
            "src": "img/Girl_0.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "19": {
        "src": "img/Airship.png",
        "alt": "Old ship suspended from floating wooly mass, flying through air.",
        "hover": "Empire of the clouds",
        "thumb": {
            "src": "img/Airship.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "18": {
        "src": "img/Old_Bar_2.png",
        "alt": "Old bar with barman sitting behind it",
        "hover": "I am very fond of the nameless barman",
        "thumb": {
            "src": "img/Old_Bar_2.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "17": {
        "src": "img/Takodachi_1.png",
        "alt": "Takodachi on a yellow background with letters spelling wah",
        "hover": "WAH!",
        "thumb": {
            "src": "img/Takodachi_1.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "16": {
        "src": "img/Item_Sprites.png",
        "alt": "assortment of crop ans tool sprites",
        "hover": "Made during my second attempt at making a game",
        "thumb": {
            "src": "img/Item_Sprites.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "15": {
        "src": "img/Eyes.png",
        "alt": "two red eyes",
        "hover": "Always watching",
        "thumb": {
            "src": "img/Eyes.png",
            "mode": "contain",
            "background": "#F8F0E8",
            "position": "50% 50%"
        }
    },
    "14": {
        "src": "img/Bobinka.png",
        "alt": "czech locomotive nicknamed bobinka",
        "hover": "Trains are cool",
        "thumb": {
            "src": "img/Bobinka.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "13": {
        "src": "img/HellSpawn.png",
        "alt": "red demon",
        "hover": "he scawy, big and hunqwy",
        "thumb": {
            "src": "img/HellSpawn.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "12": {
        "src": "img/Camera30x30.png",
        "alt": "old camera",
        "hover": "Say cheers!",
        "thumb": {
            "src": "img/Camera30x30.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "11": {
        "src": "img/Camera15x15.png",
        "alt": "old camera",
        "hover": "Say cheers!",
        "thumb": {
            "src": "img/Camera15x15.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "10": {
        "src": "img/Burger.png",
        "alt": "burger with meat, salad and cheese",
        "hover": "MMmmm tasty",
        "thumb": {
            "src": "img/Burger.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "9": {
        "src": "img/BadResolution/skyscrapper.jpg",
        "alt": "simple skyscraper",
        "hover": "Heavily inspired by art I found online",
        "thumb": {
            "src": "img/BadResolution/skyscrapper.jpg",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 0%"
        }
    },
    "8": {
        "src": "img/BadResolution/neon_city.jpg",
        "alt": "pixelart of neon city scape",
        "hover": "Reskin of the distopian city",
        "thumb": {
            "src": "img/BadResolution/neon_city.jpg",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "7": {
        "src": "img/BadResolution/distopian_city.jpg",
        "alt": "pixelart of dystopian city scape",
        "hover": "Dystopian city that watches you back",
        "thumb": {
            "src": "img/BadResolution/distopian_city.jpg",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "6": {
        "src": "img/BadResolution/bar_limonade.jpg",
        "alt": "old run down empty bar with lemonade being served",
        "hover": "At least the drink helps cover the bad art behind it.",
        "thumb": {
            "src": "img/BadResolution/bar_limonade.jpg",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "5": {
        "src": "img/BadResolution/bar.jpg",
        "alt": "old run down empty bar",
        "hover": "I was obsessed the old bar aesthetic back then. I should make more of these",
        "thumb": {
            "src": "img/BadResolution/bar.jpg",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "4": {
        "src": "img/font.png",
        "alt": "pixelated font",
        "hover": "Made for my 1st attempt at gamedev",
        "thumb": {
            "src": "img/font.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 0%"
        }
    },
    "3": {
        "src": "img/BadResolution/plantnig_pot.png",
        "alt": "wooden planting pot",
        "hover": "Made when I was 1st learning unity",
        "thumb": {
            "src": "img/BadResolution/plantnig_pot.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "2": {
        "src": "img/BadResolution/forest_cabin.jpg",
        "alt": "wooden cabin with green background",
        "hover": "Let's hope no masked weirdos show up",
        "thumb": {
            "src": "img/BadResolution/forest_cabin.jpg",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "1": {
        "src": "img/BadResolution/old_lambo.png",
        "alt": "old pixelart of purple lamborghini",
        "hover": "It's not the best, but it's the oldest that survived to this day",
        "thumb": {
            "src": "img/BadResolution/old_lambo.png",
            "mode": "contain",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "28": {
        "src": "img/monkeybar_lineart.png",
        "alt": "Lineart for art of a girl hanging upside down from monkey bars",
        "hover": "Hang on there!",
        "thumb": {
            "src": "img/monkeybar_lineart.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "29": {
        "src": "img/monkeybar.png",
        "alt": "Pixelart of girl hanging upside down from monkey bars.",
        "hover": "Hang in there!",
        "thumb": {
            "src": "img/monkeybar.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "30": {
        "src": "img/train_stop.png",
        "alt": "Girl waiting and sitting down on a bench at a train stop while a train is passing by.",
        "hover": "How long have I been waiting for?",
        "thumb": {
            "src": "img/train_stop.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "0% 0%"
        }
    },
    "31": {
        "src": "img/synt_city_widescreen.png",
        "alt": "Image of a city street in a synthwave style",
        "hover": "Made this for a friend to use as background",
        "thumb": {
            "src": "img/synt_city_widescreen.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "32": {
        "src": "img/synth_city_widescreen_outline.png",
        "alt": "Image of a city street in a synthwave style",
        "hover": "NOW WITH 3% MORE PINK!",
        "thumb": {
            "src": "img/synth_city_widescreen_outline.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "33": {
        "src": "img/girl0_gothic.png",
        "alt": "Pixelart of a gril from shoulders up. The girl is showing a peace sign and is looking at the screen.",
        "hover": "What's wrong anon? Isn't this what you wanted?",
        "thumb": {
            "src": "img/girl0_gothic.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "34": {
        "src": "img/girl1.png",
        "alt": "Girl sitting by fence, with sport water bottles placed beside her.",
        "hover": "It's ok to get tired after practice.",
        "thumb": {
            "src": "img/girl1.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "35": {
        "src": "img/Inaaa.png",
        "alt": "Pixelart of smiling ina from shoulders up",
        "hover": "WAH!",
        "thumb": {
            "src": "img/Inaaa.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "36": {
        "src": "img/rpg_item.png",
        "alt": "12 sprites for various rpg items",
        "hover": "Some attempt at practice took place",
        "thumb": {
            "src": "img/rpg_item.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "37": {
        "src": "img/CRT.gif",
        "alt": "Animation of camera moving along classic synth landscape on a crt monitor with heavy static",
        "hover": "Believe!",
        "thumb": {
            "src": "img/CRT.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "38": {
        "src": "img/Toxic_Love.png",
        "alt": "ouline of heart with toxic love written on it and many small phrases and images written behind it.",
        "hover": "Never again . . .",
        "thumb": {
            "src": "img/Toxic_Love.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    },
    "39": {
        "src": "img/riced_240sx.png",
        "alt": "Pixelart of pink nissan 240sx against glitchy background",
        "hover": "See you later, aligator!",
        "thumb": {
            "src": "img/riced_240sx.png",
            "mode": "contain",
            "background": "#000000",
            "position": "50% 50%"
        }
    },
    "40": {
        "src": "img/Boards.png",
        "alt": "3 Skateboards with images on their bottom displayed next to each other.",
        "hover": "Whic one would you rock?",
        "thumb": {
            "src": "img/Boards.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "0% 0%"
        }
    },
    "41": {
        "src": "img/Girl_Mixels.png",
        "alt": "Girl with black hair, red eyes and red facepaint",
        "hover": "How devilish",
        "thumb": {
            "src": "img/Girl_Mixels.png",
            "mode": "cover",
            "background": "#14162c",
            "position": "50% 50%"
        }
    }
}

let currentImageId = undefined;

//premenné pre prácu s posunom po dotykových obrazovkách
let touchStart = undefined;
let touchLast = undefined;

//premenné a konštanty používané pri približovaní obrázku
let offsetX = 0;
let offsetY = 0;
let currentZoom = 1;
const minZoom = 1;
const maxZoom = 3;
const stepSize = 0.001;

//konštanty s 
const modalContainer = document.getElementById('modal-display');
const aspectRatioContainer = document.getElementById('aspect-ratio-container');
const modalImage = document.getElementById('modal-image');

//funkcia ktorá pomocou cyklu naplní galériu obrázkami zo slovníku
function loadImages() {
    for (const [id, image] of Object.entries(images)) {
        createImageElement(id, image)
    }
};

//funkcia ktorá pridá do galérie obrázok podľa zadaných údajov
//údaje sú zapísané v slovníkoch
//náhľad obrázku v ňom má definovanú cestu k obrázku, pozadie, mód zobrazenia, a pozícia vrámci rámčeku ak bol v object-fit požitý mód cover alebo none
//pre náhľad aj detail obrázku je definovaný len jeden alt text aj id ktoré sú používané obi dvomi
function createImageElement(id, image) {
    const img = document.createElement('img');

    img.id = id;
    img.src = image.thumb.src;
    img.alt = image.alt;

    img.style.objectFit = image.thumb.mode;
    img.style.objectPosition = image.thumb.position;
    img.style.backgroundColor = image.thumb.background;

    img.classList.add('grid-item', 'gallery-image');
    img.addEventListener('click', openModal);

    const gallery = document.getElementById('main-gallery');
    gallery.prepend(img);
};

//funkcia na otvorenie detailu obrázka
//spustí funkciu, ktorá bráni posunu po stránke
//zistí id obrázku na ktorý bolo kliknuté a použije ho aby nastavil obrázok podľa údajov zo slovníka
//pre detail obrázku je definovaná cesto k obrázka, a text, ktorý sa zobrazí pri prejdení myšou
//nakoniec nastaví zobrazenie pre kontajner obrázku na flex a nastaví aspect ratio obrázku a jeho kontajneru  
function openModal() {
    disableScroll();
    currentImageId = this.id;

    modalImage.src = images[currentImageId].src;
    modalImage.alt = images[currentImageId].alt;
    modalImage.title = images[currentImageId].hover;

    let aspectRatio = calculateAspectRatio(modalImage.src);
    modalImage.style.aspectRatio = aspectRatio;
    aspectRatioContainer.style.aspectRatio = aspectRatio;
    modalContainer.style.display = "flex";
}
//funkcia na zatvorenie detailu obrázku
//nastaví zobrazenie detailu obrázku na none a znovu povolí pohyb po stránke 
//vynuluje premenné týkajúce sa zobrazeného obrázku
function closeModal() {
    modalContainer.style.display = "none";
    enableScroll();
    resetModalImage();
}

//Zapíše údaje o začiatku dotyka a posledným miestom dotyka na dotykovej obrazovke
function touchScrollStart(e) {
    touchStart = {
        x: e.touches[0].clientX,
        y: e.touches[0].clientY
    };
    touchLast = {
        x: 0,
        y: 0
    };
};

//Pri posune po obrazovke zistí kam sa dotyk posunul a nastaví do premennej rozdiel od počiatočného miesta dotyka
//Podľa toho, či je posun väčší horizontálne alebo vertikálne upraví polohu a priehľadnosť obrázku
//To dáva užívateľovi odozvu o jeho akcií
function touchScroll(e) {
    touchLast.x = touchStart.x - e.touches[0].clientX,
        touchLast.y = touchStart.y - e.touches[0].clientY

    if (Math.abs(touchLast.x) > Math.abs(touchLast.y)) {
        modalImage.style.transform = "translate(" + -touchLast.x * 2 + "px, 0px)";
        modalImage.style.opacity = (110 - Math.abs(touchLast.x)) / 110;
    }
    else {
        modalImage.style.transform = "translate(0px, " + -touchLast.y + "px)";
        modalImage.style.opacity = (250 - Math.abs(touchLast.y)) / 250;
        modalContainer.style.opacity = (250 - Math.abs(touchLast.y)) / 250;
    }
}

//Pri ukončení dotyka zistí či nastal väčší posun vertikálne alebo horizontálne
//Ak v danom smere prekročil stanovenú hodnotu príde k posunu na iný obrázok alebo jeho zatvorenie
//Ak neboli prekročené žiadne hodnoty nastaví štýl obrázku späť na pôvodné hodnoty
function touchScrollEnd(e) {
    if (Math.abs(touchLast.x) > Math.abs(touchLast.y)) {
        if (touchLast.x > 100) {
            nextImageSwipe(1);
            return
        }
        if (touchLast.x < 100) {
            nextImageSwipe(-1);
            return
        }
    }
    if (Math.abs(touchLast.y) > 150) {
        closeModal();
        return;
    }
    modalImage.style.transform = "translate(0px, 0px) scale(1)";
    modalImage.style.opacity = "unset";
    modalContainer.style.opacity = "unset";
}

//Resetuje hodnoty obrázku ako zoom, odsadenie a zmenu štýlu
function resetModalImage() {
    currentZoom = 1;
    offsetX = 0;
    offsetY = 0;
    modalImage.style.transform = "translate(0px, 0px) scale(1)";
    modalImage.style.aspectRatio = "unset";
    modalImage.style.opacity = "unset"
    modalContainer.style.opacity = "unset";
}

//zmení uložené id podľa smeru prechodu, ak sa pri tom došlo k hodnote mimo rozmedzia prejde medzi začiatkom a koncom galérií
//volá funkciu na reset štýlov obrázka na predvolenú hodnotu
//použije nové id aby nastavil obrázok podľa údajov zo slovníka
function nextImage(direction) {
    currentImageId -= direction;
    let length = Object.keys(images).length
    currentImageId = currentImageId < 1 ? length : currentImageId;
    currentImageId = currentImageId > length ? 1 : currentImageId;

    resetModalImage();

    modalImage.src = images[currentImageId].src;
    modalImage.alt = images[currentImageId].alt;
    modalImage.title = images[currentImageId].hover;

    let aspectRatio = calculateAspectRatio(modalImage.src);
    modalImage.style.aspectRatio = aspectRatio;
    aspectRatioContainer.style.aspectRatio = aspectRatio;
}

//prechod na ďalší obrázok pri posune pomocou dotyka
//pridá na obrázok triedu no-transition, ktorá vypne prechody a posunie ho na druhú stranu, potom triedu odstráni
//to animuje prechod medzi obrázkami pri posune
//následne zavolá funkciu na bežný prechod po obrázku ktorá ho zmení na ďalší
function nextImageSwipe(direction) {
    modalImage.classList.add("no-transition");
    modalImage.style.transform = "translate(" + direction * 250 + "px, 0px)";
    modalImage.style.opacity = 0;
    modalImage.offsetHeight; //flushing the CSS changes by reading them
    modalImage.classList.remove("no-transition");
    nextImage(direction);
}

//vytvorí premennú img a nastaví ju na zvolený obrázok
//zistí jeho rozmery a vráti ich vo formáte používanom v css vlastnosti aspect ratio
//to je použité na to aby mal element obrázku skutočne rozmery obrázku ktorý zobrazuje, bez toho aby došlo k jeho orezaniu
//takto to bolo potrebné robiť preto, že som chcel aby bolo za obrázkami s priehladnostou zobrazené pozadie o veľkosti daného obrázku
function calculateAspectRatio(src) {
    let img = new Image();
    img.src = src;
    return img.naturalWidth + "/" + img.naturalHeight;
}

//približovanie obrázku - je pripojené na event posunu kolieska myši
//vypočíta nový zoom podľa posunu kolieska a aktuálneho priblíženia
//nastaví nový zoom vrámci zvoleného rozmedzia <minZoom; maxZoom>
//vypočíta taký posun obrázku aby zostal pod kurzorom myši ten istý bod obrázku
//nakoniec pomocou css vlastnosti translate nastaví toto priblíženie a posun
function zoomImage(e) {
    let deltaZoom = -e.deltaY * currentZoom * stepSize;
    let newZoom = currentZoom + deltaZoom;

    if (newZoom < minZoom) {
        newZoom = minZoom;
        deltaZoom = newZoom - currentZoom
    }
    else if (newZoom > maxZoom) {
        newZoom = maxZoom;
        deltaZoom = newZoom - currentZoom
    }

    if (deltaZoom === 0) {
        return;
    }

    let zoomPointX = e.clientX - (modalImage.offsetLeft + offsetX);
    let zoomPointY = e.clientY - (modalImage.offsetTop + offsetY);

    offsetX -= zoomPointX * deltaZoom / currentZoom;
    offsetY -= zoomPointY * deltaZoom / currentZoom;

    if (newZoom == 1) {
        offsetX = 0;
        offsetY = 0;
    }

    currentZoom = newZoom;

    modalImage.style.transform = "translate(" + offsetX + "px, " + offsetY + "px) scale(" + currentZoom + ")";
}

//Ak je kliknuté na jeden z kontajnerov na pozadí obrázku, obrázok sa zatvorí
window.addEventListener('click', function (event) {
    if (event.target === modalContainer || event.target === aspectRatioContainer)
        closeModal()
});

//Pri točení kolečka myši sa mení priblíženie obrázku 
modalImage.addEventListener("wheel", zoomImage);

//Nastavenie šípok po boku obrázku na prepínanie medzi obrázkami
document.getElementById('modal-prev-arrow').addEventListener('click', function () { nextImage(-1) });
document.getElementById('modal-next-arrow').addEventListener('click', function () { nextImage(1) });

//nastavenie eventov na prechádzanie medzi obrázkami a ich zatvorenie na dotykových displejoch
//funkcie je možné spustiť len keď nie je obrázok priblížení
document.addEventListener('touchstart', function (event) {
    if (currentZoom != 1 || modalContainer.style.display === "none")
        return;
    touchScrollStart(event);
});

document.addEventListener('touchmove', function (event) {
    if (!touchStart || currentZoom != 1 || modalContainer.style.display === "none")
        return;
    touchScroll(event);
});

document.addEventListener('touchend', function () {
    if (!touchStart || currentZoom != 1 || modalContainer.style.display === "none")
        return;
    touchScrollEnd(event);
});

//nastavenie eventov na prechádzanie medzi obrázkami a ich zatvorenie pomocou kláves 
window.addEventListener('keydown', function (event) {
    if (modalContainer.style.display === "none")
        return;
    if (event.key === 'ArrowRight')
        nextImage(1);
    else if (event.key === 'ArrowLeft')
        nextImage(-1);
    else if (event.key === 'Escape')
        closeModal();
    else
        return;
    event.preventDefault();
});

//spustí funkciu na pridanie obrázkov do galérie
loadImages();